<!DOCTYPE html>
<html>
    <style>
    .titulo{
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 5em;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10;
    }
    
    </style>
    <script src="https://aframe.io/releases/1.0.0/aframe.min.js"></script>
    <!-- we import arjs version without NFT but with marker + location based support -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://raw.githack.com/fcor/arjs-gestures/master/dist/gestures.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script>
        var playing = false;
        
        //HTML5 audio, will need user touch input to start on mobile
        var intro = new Audio("assets/audio/aud1.mp3");

        //Detect end of audio
        intro.addEventListener("ended", function() {
            intro.currentTime = 0;
            playing = false;
        });
        
        AFRAME.registerComponent('markerhandler', {
        init: function() {
            // Set up the tick throttling. Will check if marker is active every 500ms
            this.tick = AFRAME.utils.throttleTick(this.tick, 500, this);
        },
        tick: function(t, dt) {
            
            if (document.querySelector("hiro").object3D.visible == true && playing == false) {
                // MARKER IS PRESENT
                intro.play();
                playing = true;
            } else {
                // MARKER IS HIDDEN, do nothing (up to you)
            }

        }
    });
        
    </script>
    <body style="margin : 0px; overflow: hidden;">
        <div class="titulo">
            <h1>À Procura do Tritão</h1>
        </div>
        
        <a-scene
            arjs
            embedded
            renderer="logarithmicDepthBuffer: true;"
            vr-mode-ui="enabled: false"
            gesture-detector
            id="scene"
            >
            <a-assets>
                <a-asset-item
                id="bowser"
                src="https://cdn.glitch.com/06bd98b4-97ee-4c07-a546-fe39ca205034%2Fbowser.glb"
                >
                </a-asset-item>
                <audio id="oud1" src="assets/audio/aud1.mp3" preload="auto"></audio>
            </a-assets>

            <a-marker
                preset="hiro"
                raycaster="objects: .clickable"
                emitevents="true"
                cursor="fuse: false; rayOrigin: mouse;"
                id="markerA"
            >
                <a-entity
                id="bird-model"
                gltf-model="scene.gltf"
                position="0 0 0"
                scale="15 15 15"
                rotation="-45 0 0"
                class="clickable"
                gesture-handler
                animation-mixer="clip: hover;"
                sound="src: url(assets/audio/aud1.mp3) ; on: click"
                >
                </a-entity>
            </a-marker>
            <a-entity camera></a-entity>
        </a-scene>
        
    </body>
</html>
